!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).MP3Tag=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function s(e,t,r){return(s=o()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&a(i,r.prototype),i}).apply(null,arguments)}function u(e){var t="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return s(e,arguments,i(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,e)})(e)}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return function(){var t,r=i(e);if(o()){var n=i(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return f(this,t)}}function h(e,t){var r=[];switch(t){case"utf-8":r=function(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&e.charCodeAt(r)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return t}(e);break;case"utf-16":case"utf-16be":for(var n=new ArrayBuffer(2*e.length),i=new Uint16Array(n),a=new Uint8Array(n),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);r=[255,254],a.forEach((function(e){return r.push(e)}));break;default:for(var s=0;s<e.length;s++)r.push(e.charCodeAt(s))}return r}var l=function(t){n(a,t);var i=c(a);function a(){return e(this,a),i.apply(this,arguments)}return r(a,[{key:"getString",value:function(e,t,r){var n=this.getUint8(e,t),i="";switch(r){case"utf-8":i=function(e){var t="",r=0,n=0,i=0,a=0;for(r+=239===e[0]&&187===e[1]&&191===e[2]?3:0;r<e.length;)switch((n=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(n);break;case 12:case 13:i=e[r++],t+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=e[r++],a=e[r++],t+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&a)<<0);break;default:t+=""}return t}(n);break;case"utf-16":case"utf-16be":var a=null;255===n[0]&&254===n[1]?a=!0:254===n[0]&&255===n[1]&&(a=!1),null!==a&&(e+=2,t-=2),i=this.getUint16String(e,t,!0===a);break;default:i=this.getUint8String(e,t)}return i.match(/^[\s\S]+(\0)$/)&&(i=i.substr(0,i.length-1)),i}},{key:"getCString",value:function(e,t){var r,n=[],i=[];i="utf-16"===t||"utf-16be"===t?this.getUint16(e,this.byteLength-e):this.getUint8(e,this.byteLength-e);for(var a=0;a<i.length&&0!==i[a];a++)n.push(i[a]);r=i.BYTES_PER_ELEMENT;var o=n.length*r;return{string:this.getString(e,o,t),length:o+r}}},{key:"getUint8String",value:function(e,t){var r=this.getUint8(e,t),n="";ArrayBuffer.isView(r)||(r=[r]);for(var i=0;i<r.length;i++){n+=String.fromCharCode(r[i])}return n}},{key:"getUint8CString",value:function(e){var t=this.getUint8(e,this.byteLength-e),r="";ArrayBuffer.isView(t)||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];if(0===i)break;r+=String.fromCharCode(i)}return r}},{key:"getUint16String",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getUint16(e,t,r),i="";ArrayBuffer.isView(n)||(n=[n]);for(var a=0;a<n.length;a++){var o=String.fromCharCode(n[a]);i+=o}return i}},{key:"getUint16CString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getUint16(e,this.byteLength-e,t),n="";ArrayBuffer.isView(r)||(r=[r]);for(var i=0;i<r.length;i++){var a=r[i];if(0===a)break;var o=String.fromCharCode(a);n+=o}return n}},{key:"getUint8",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e+t,n=new Uint8Array(t),i=0;e<this.byteLength&&e<r;)n[i]=DataView.prototype.getUint8.call(this,e++),i++;return 1===t?n[0]:n}},{key:"getUint16",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e+t,i=new Uint16Array(t/2),a=0;e<this.byteLength&&e<n;)i[a]=DataView.prototype.getUint16.call(this,e,r),e+=2,a++;return 1===t?i[0]:i}}]),a}(u(DataView));function v(e,t){return(e&1<<t)>0}function d(e){for(var t=0,r=2130706432;r;)t>>=1,t|=e&r,r>>=8;return t}function g(e){for(var t=0,r=127;2147483647^r;)t=e&~r,t<<=1,t|=e&r,r=(r+1<<8)-1,e=t;return t}function p(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){t.forEach?t.forEach((function(t){return e.push(t)})):e.push(t)})),new Uint8Array(e)}var w={0:"Unknown error",1:"This format is not yet supported",200:"This file is not an ID3v2",201:"Unsupported ID3v2 major version",202:"Unsupported frame",203:"Frame validation",204:"Frame is not supported in this version of ID3v2"},y=function(t){n(a,t);var i=c(a);function a(t){var r;return e(this,a),(r=i.call(this,w[t])).name="TagError",r.code=t,r.errorId=arguments.length<=1?void 0:arguments[1],r.message=r.parseMessage(),r}return r(a,[{key:"parseMessage",value:function(){var e="";switch(this.code){case 200:e="ID3v2 Error: ".concat(w[this.code]);break;case 201:case 202:case 203:case 204:e="ID3v2 Error: ".concat(w[this.code],' "').concat(this.errorId,'"');break;default:e="".concat(w[this.code])}return e}}]),a}(u(Error));function b(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){return e.push(t)})):e.push(t)})),e}var m=["ascii","utf-16","utf-16be","utf-8"];function T(e,t){var r,n=m[e.getUint8(0)];switch(t){case 3:r=e.getCString(1,n).string;break;case 4:1===(r=e.getString(1,e.byteLength-1,n).split("\0")).length&&(r=r[0]);break;default:throw new y(201,t)}return r}function U(e,t){var r=T(e,t),n=[];switch(t){case 3:n=r.split("/");break;case 4:n=Array.isArray(r)?r:[r];break;default:throw new y(201,t)}return n}function A(e,t){var r=T(e,t);return r.match(/^(\d+)$/)?parseInt(r):r}function E(e,t){var r=b(T(e,t)),n=[];return r.forEach((function(e){var t=e.split("/");n.push(e.match(/^(\d+)\/(\d+)/)?{position:parseInt(t[0]),total:parseInt(t[1])}:e)})),1===n.length?n[0]:n}function S(e,t){return e.getCString(0,"ascii").string}function k(e,t){var r=m[e.getUint8(0)],n=e.getCString(4,r),i=e.byteLength-n.length-4,a=e.getString(n.length+4,i,r);return{language:e.getString(1,3,"ascii"),descriptor:n.string,text:a}}var C=/^(https?):\/\/[^\s/$.?#]+\.[^\s]*/,I=/^([a-z]{3}|XXX)$/,O="(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",L="^(".concat("(\\d{4})","(-").concat("(0[1-9]|1[0-2])","(-").concat("(0[1-9]|1\\d|2\\d|3[0-1])","(T").concat("(0\\d|1\\d|2[0-3])","(:").concat(O,"(:").concat("(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",")?)?)?)?)?)$");function j(e){if(!e.match(/^([a-zA-Z0-9]{4})$/))throw new y(203,"ID is invalid");return!0}function B(e,t){return j(e.id),b(e.value).forEach((function(t){if("string"!=typeof t)throw new y(203,"".concat(e.id," value is not a string"))})),!0}function P(e,t){if(j(e.id),!Array.isArray(e.value))throw new y(203,"".concat(e.id," value is not an array"));return e.value.forEach((function(t){if("string"!=typeof t)throw new y(203,"".concat(e.id," value is not a string"))})),!0}function D(e,t){return j(e.id),b(e.value).forEach((function(t){if("number"!=typeof t)throw new y(203,"".concat(e.id," value is not a number"))})),!0}function R(e,t){return j(e.id),b(e.value).forEach((function(t){if("number"!=typeof t.position||"number"!=typeof t.total)throw new y(203,"".concat(e.id," position/total is not a number"));if(t.position>t.total)throw new y(203,"".concat(e.id," position is greater than total"))})),!0}function x(e,t){return j(e.id),b(e.value).forEach((function(r){switch(t){case 3:if(!r.toString().match(/^(\d{4})$/))throw new y(203,"".concat(e.id," is not 4 numeric characters"));break;case 4:if("string"!=typeof r)throw new y(203,"".concat(e.id," value is not a string"));if(!r.match(L))throw new y(203,"Time Frames should follow ISO 8601");break;default:throw new y(201,t)}})),!0}function M(e,t){if(j(e.id),"string"!=typeof e.value)throw new y(203,"".concat(e.id," value is not a string"));if(!e.value.match(C))throw new y(203,"URL is not a valid URL");return!0}function F(e,t){j(e.id);var r=b(e.value),n=[];return r.forEach((function(e){if("string"!=typeof e.language||"string"!=typeof e.descriptor||"string"!=typeof e.text)throw new y(203,"Language/descriptor/text is not a string");if(!e.language.match(I))throw new y(203,"Language does not follow ISO 639-2");if(n.includes(e.descriptor))throw new y(203,"Language/descriptor/text should not duplicate");n.push(e.descriptor)})),!0}function _(e,t,r){var n=h(e,"ascii"),i=new l(new ArrayBuffer(4));switch(r){case 3:i.setUint32(0,t);break;case 4:i.setUint32(0,g(t));break;default:throw new y(201,r)}return p(n,i.getUint8(0,4),0,0)}function z(e,t){var r=0,n=[];switch(t){case 3:r=1,n=h(e.value+"\0","utf-16");break;case 4:r=3,Array.isArray(e.value)?e.value.forEach((function(e){h(e+"\0","utf-8").forEach((function(e){return n.push(e)}))})):n=h(e.value+"\0","utf-8");break;default:throw new y(201,t)}return p(_(e.id,n.length+1,t),r,n)}function N(e,t){switch(t){case 3:e.value=e.value.join("/");break;case 4:break;default:throw new y(201,t)}return z(e,t)}function V(e,t){var r=h(e.value.toString()+"\0","ascii");return p(_(e.id,r.length+1,t),0,r)}function W(e,t){switch(t){case 3:e.value=e.value.position+"/"+e.value.total;break;case 4:var r=b(e.value),n=[];r.forEach((function(e){n.push(e.position+"/"+e.total)})),e.value=n.join("\0");break;default:throw new y(201,t)}return V(e,t)}function X(e,t){var r=h(e.value+"\0","ascii");return p(_(e.id,r.length,t),r)}function $(e,t){var r=[];return b(e.value).forEach((function(n){var i=0,a=h(n.language,"ascii"),o=[],s=[];switch(t){case 3:i=1,o=h(n.descriptor+"\0","utf-16"),s=h(n.text,"utf-16");break;case 4:i=3,o=h(n.descriptor+"\0","utf-8"),s=h(n.text,"utf-8");break;default:throw new y(201,t)}var u=o.length+s.length+4;p(_(e.id,u,t),i,a,o,s).forEach((function(e){return r.push(e)}))})),r}var Y={parse:function(e,t){var r=m[e.getUint8(0)],n=e.getCString(1,"ascii"),i=e.getUint8(n.length+1),a=e.getCString(n.length+2,r),o=e.byteLength-n.length-a.length-2,s=e.getUint8(n.length+a.length+2,o);return{format:n.string,type:i,description:a.string,data:s}},validate:function(e,t){j(e.id);var r=b(e.value),n=[];return r.forEach((function(e){if("string"!=typeof e.format||"string"!=typeof e.description||"number"!=typeof e.type)throw new y(203,"MIME, type, or description is invalid");if(!(e.data instanceof ArrayBuffer||Array.isArray(e.data)||ArrayBuffer.isView(e.data)))throw new y(203,"Image data should be ArrayBuffer or an array");if(n.includes(e.description))throw new y(203,"Cover description should not duplicate");if(n.push(e.description),e.description.length>64)throw new y(203,"Description should not exceed 64");if(!e.format.match(/(image\/[a-z0-9!#$&.+\-^_]+){0,129}/))throw new y(203,"MIME type should be an image")})),!0},write:function(e,t){var r=[];return b(e.value).forEach((function(n){var i=0,a=h(n.format+"\0","ascii"),o=new Uint8Array(n.data),s=[];switch(t){case 3:i=1,s=h(n.description+"\0","utf-16");break;case 4:i=3,s=h(n.description+"\0","utf-8");break;default:throw new y(201,t)}var u=a.length+s.length+o.length+2;p(_(e.id,u,t),i,a,n.type,s,o).forEach((function(e){return r.push(e)}))})),r},version:[3,4]},G={parse:k,validate:F,write:$,version:[3,4]},K={parse:function(e,t){var r=m[e.getUint8(0)],n=e.getCString(1,"ascii"),i=e.getCString(n.length+1,r),a=e.getCString(i.length+n.length+1,r),o=n.length+i.length+a.length+1,s=e.byteLength-o,u=e.getUint8(o,s);return{format:n.string,filename:i.string,description:a.string,object:u}},validate:function(e,t){j(e.id);var r=b(e.value),n=[],i=[];return r.forEach((function(e){if("string"!=typeof e.format||"string"!=typeof e.filename||"string"!=typeof e.description)throw new y(203,"GEOB MIME/Filename/description is not a string");if(!(e.object instanceof ArrayBuffer||Array.isArray(e.object)||ArrayBuffer.isView(e.object)))throw new y(203,"Object data should be ArrayBuffer or an array");if(n.includes(e.description))throw new y(203,"GEOB description should not duplicate");if(n.push(e.description),function(e,t){for(var r=!1,n=0;n<e.length&&!r;){if(e[n].length===t.length){for(var i=!0,a=0;a<t.length;a++)if(t[a]!==e[n][a]){i=!1;break}i&&(r=!0)}n++}return r}(i,e.object))throw new y(203,"GEOB object should not duplicate");i.push(e.object)})),!0},write:function(e,t){var r=[];return b(e.value).forEach((function(n){var i,a,o,s=h(n.format+"\0","ascii"),u=new Uint8Array(n.object);switch(t){case 3:i=1,a=h(n.filename+"\0","utf-16"),o=h(n.description+"\0","utf-16");break;case 4:i=3,a=h(n.filename+"\0","utf-8"),o=h(n.description+"\0","utf-8");break;default:throw new y(201,t)}var f=s.length+a.length+o.length+u.length+1;p(_(e.id,f,t),i,s,a,o,u).forEach((function(e){return r.push(e)}))})),r},version:[3,4]},Z={parse:function(e,t){for(var r=m[e.getUint8(0)],n=[],i=1;i<e.byteLength;){var a=e.getCString(i,r);n.push(a.string),i+=a.length}return n},validate:P,write:function(e,t){var r,n=[];switch(t){case 3:r=1,e.value.forEach((function(e){h(e+"\0","utf-16").forEach((function(e){return n.push(e)}))}));break;case 4:default:throw new y(201,t)}var i=n.length+1;return p(_(e.id,i,t),r,n)},version:[3]},H={parse:T,validate:B,write:z,version:[3,4]},q={parse:A,validate:D,write:V,version:[3,4]},J={parse:U,validate:P,write:N,version:[3,4]},Q={parse:T,validate:B,write:z,version:[3,4]},ee={parse:T,validate:B,write:z,version:[3,4]},te={parse:A,validate:x,write:V,version:[3]},re={parse:T,validate:x,write:V,version:[4]},ne={parse:A,validate:D,write:V,version:[3]},ie={parse:T,validate:x,write:V,version:[4]},ae={parse:T,validate:x,write:z,version:[4]},oe={parse:T,validate:x,write:V,version:[4]},se={parse:T,validate:x,write:z,version:[4]},ue={parse:T,validate:B,write:z,version:[3,4]},fe={parse:U,validate:P,write:N,version:[3,4]},ce={parse:T,validate:B,write:z,version:[3,4]},he={parse:A,validate:x,write:V,version:[3]},le={parse:U,validate:P,write:z,version:[4]},ve={parse:T,validate:B,write:z,version:[3,4]},de={parse:T,validate:B,write:z,version:[3,4]},ge={parse:T,validate:B,write:z,version:[3,4]},pe={parse:T,validate:function(e,t){return j(e.id),b(e.value).forEach((function(e){if("string"!=typeof e)throw new y(203,"TKEY is not a string");if(!e.match(/^([A-Gb#mo]{3})$/))throw new y(203,"Invalid TKEY Format (e.g. Cbm)")})),!0},write:V,version:[3,4]},we={parse:T,validate:function(e,t){return j(e.id),b(e.value).forEach((function(e){if("string"!=typeof e)throw new y(203,"TLAN is not a string");if(!e.match(I))throw new y(203,"Language does not follow ISO 639-2")})),!0},write:V,version:[3,4]},ye={parse:A,validate:D,write:V,version:[3,4]},be={parse:U,validate:P,write:z,version:[4]},me={parse:T,validate:B,write:z,version:[3,4]},Te={parse:T,validate:B,write:z,version:[4]},Ue={parse:T,validate:B,write:z,version:[3,4]},Ae={parse:T,validate:B,write:z,version:[3,4]},Ee={parse:U,validate:P,write:N,version:[3,4]},Se={parse:U,validate:P,write:N,version:[3,4]},ke={parse:A,validate:x,write:V,version:[3]},Ce={parse:T,validate:B,write:z,version:[3,4]},Ie={parse:U,validate:P,write:N,version:[3,4]},Oe={parse:T,validate:B,write:z,version:[3,4]},Le={parse:T,validate:B,write:z,version:[3,4]},je={parse:T,validate:B,write:z,version:[3,4]},Be={parse:E,validate:R,write:W,version:[3,4]},Pe={parse:T,validate:B,write:z,version:[4]},De={parse:T,validate:B,write:z,version:[3,4]},Re={parse:E,validate:R,write:W,version:[3,4]},xe={parse:T,validate:B,write:z,version:[3]},Me={parse:T,validate:B,write:z,version:[3,4]},Fe={parse:T,validate:B,write:z,version:[3,4]},_e={parse:A,validate:D,write:V,version:[3]},ze={parse:T,validate:B,write:z,version:[4]},Ne={parse:T,validate:B,write:z,version:[4]},Ve={parse:T,validate:B,write:z,version:[4]},We={parse:T,validate:B,write:z,version:[4]},Xe={parse:T,validate:function(e,t){return j(e.id),b(e.value).forEach((function(e){if("string"!=typeof e)throw new y(203,"TSRC is not a string");if(!e.match(/^([a-zA-Z0-9]{12})$/))throw new y(203,"Invalid ISRC format")})),!0},write:V,version:[3,4]},$e={parse:T,validate:B,write:z,version:[3,4]},Ye={parse:T,validate:B,write:z,version:[4]},Ge={parse:A,validate:x,write:V,version:[3]},Ke={parse:function(e,t){var r=m[e.getUint8(0)],n=e.getCString(1,r),i=e.byteLength-n.length-1,a=e.getString(n.length+1,i,r);return{description:n.string,text:a}},validate:function(e){j(e.id);var t=b(e.value),r=[];return t.forEach((function(e){if("string"!=typeof e.description||"string"!=typeof e.text)throw new y(203,"User-defined text/description is not a string");if(r.includes(e.description))throw new y(203,"User-defined description should not duplicate");r.push(e.description)})),!0},write:function(e,t){var r=[];return b(e.value).forEach((function(n){var i=0,a=[],o=[];switch(t){case 3:i=1,a=h(n.description+"\0","utf-16"),o=h(n.text+"\0","utf-16");break;case 4:i=3,a=h(n.description+"\0","utf-8"),o=h(n.text+"\0","utf-8");break;default:throw new y(201,t)}var s=a.length+o.length+1;p(_(e.id,s,t),i,a,o).forEach((function(e){return r.push(e)}))})),r},version:[3,4]},Ze={parse:function(e,t){var r=e.getCString(0,"ascii"),n=e.getUint8(r.length,e.byteLength-r.length);return{ownerId:r.string,id:n}},validate:function(e,t){j(e.id);var r=b(e.value),n=[];return r.forEach((function(e){if("string"!=typeof e.ownerId)throw new y(203,"UFID ownerId is not a string");if(!(e.id instanceof ArrayBuffer||Array.isArray(e.id)||ArrayBuffer.isView(e.id)))throw new y(203,"UFID id should be ArrayBuffer or an array");if((e.id.byteLength||e.id.length||0)>64)throw new y(203,"UFID id exceeds 64 bytes");if(n.includes(e.ownerId))throw new y(203,"UFID ownerId should not duplicate");n.push(e.ownerId)})),!0},write:function(e,t){var r=[];return b(e.value).forEach((function(n){var i=h(n.ownerId+"\0","ascii"),a=new Uint8Array(n.id);p(_(e.id,i.length+a.length,t),i,a).forEach((function(e){return r.push(e)}))})),r},version:[3,4]},He={parse:k,validate:F,write:$,version:[3,4]},qe={parse:S,validate:M,write:X,version:[3,4]},Je={parse:S,validate:M,write:X,version:[3,4]},Qe={parse:S,validate:M,write:X,version:[3,4]},et={parse:S,validate:M,write:X,version:[3,4]},tt={parse:S,validate:M,write:X,version:[3,4]},rt={parse:S,validate:M,write:X,version:[3,4]},nt={parse:S,validate:M,write:X,version:[3,4]},it={parse:S,validate:M,write:X,version:[3,4]},at={parse:function(e,t){var r=m[e.getUint8(0)],n=e.getCString(1,r),i=e.byteLength-n.length-1,a=e.getString(n.length+1,i,"ascii");return{description:n.string,url:a}},validate:function(e,t){j(e.id);var r=b(e.value),n=[];return r.forEach((function(e){if("string"!=typeof e.description||"string"!=typeof e.url)throw new y(203,"User-defined text/description is not a string");if(!e.url.match(C))throw new y(203,"User-defined URL is an invalid URL");if(n.includes(e.description))throw new y(203,"User-defined description should not duplicate");n.push(e.description)})),!0},write:function(e,t){var r=[];return b(e.value).forEach((function(n){var i=0,a=[],o=[];switch(t){case 3:i=1,a=h(n.description+"\0","utf-16"),o=h(n.url,"ascii");break;case 4:i=3,a=h(n.description+"\0","utf-8"),o=h(n.url,"ascii");break;default:throw new y(201,t)}var s=a.length+o.length+1;p(_(e.id,s,t),i,a,o).forEach((function(e){return r.push(e)}))})),r},version:[3,4]},ot=Object.freeze({__proto__:null,APIC:Y,COMM:G,GEOB:K,IPLS:Z,TALB:H,TBPM:q,TCOM:J,TCON:Q,TCOP:ee,TDAT:te,TDEN:re,TDLY:ne,TDOR:ie,TDRC:ae,TDRL:oe,TDTG:se,TENC:ue,TEXT:fe,TFLT:ce,TIME:he,TIPL:le,TIT1:ve,TIT2:de,TIT3:ge,TKEY:pe,TLAN:we,TLEN:ye,TMCL:be,TMED:me,TMOO:Te,TOAL:Ue,TOFN:Ae,TOLY:Ee,TOPE:Se,TORY:ke,TOWN:Ce,TPE1:Ie,TPE2:Oe,TPE3:Le,TPE4:je,TPOS:Be,TPRO:Pe,TPUB:De,TRCK:Re,TRDA:xe,TRSN:Me,TRSO:Fe,TSIZ:_e,TSOA:ze,TSOC:Ne,TSOP:Ve,TSOT:We,TSRC:Xe,TSSE:$e,TSST:Ye,TYER:Ge,TXXX:Ke,UFID:Ze,USLT:He,WCOM:qe,WCOP:Je,WOAF:Qe,WOAR:et,WOAS:tt,WORS:rt,WPAY:nt,WPUB:it,WXXX:at}),st=function(){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.buffer=r,this.options={padding:void 0!==n.padding?n.padding:4096,version:void 0!==n.version&&n.version},this.frames=[]}return r(t,[{key:"read",value:function(){var e=new l(this.buffer);if("ID3"!==e.getUint8String(0,3))throw new y(200);var t=e.getUint8(3,2);switch(t[0]){case 3:case 4:this.major=t[0],this.minor=t[1];break;default:throw new y(201,t[0])}this.size=d(e.getUint32(6)),this.flags=function(e,t){var r={};switch(t){case 3:r.unsynchronisation=v(e,7),r.extendedHeader=v(e,6),r.experimentalIndicator=v(e,5);break;case 4:r.unsynchronisation=v(e,7),r.extendedHeader=v(e,6),r.experimentalIndicator=v(e,5),r.footerPresent=v(e,4);break;default:throw new y(201,t)}return r}(e.getUint8(5),this.major),this.frames=[];for(var r=10;r<this.size;){var n=e.getUint8(r,this.size),i=ut.call(this,n);if(!i)break;this.frames.push(i),r+=i.size+10}return this.frames}},{key:"validate",value:function(){var e=this.parse();for(var t in e){var r=ot[t],n={id:t,value:e[t]};if(!r)throw new y(202,t);if(!r.version.includes(this.major))throw new y(204,t);r.validate(n,this.major)}return!0}},{key:"save",value:function(){if(0===this.frames.length)return this.getAudio().buffer;if(this.major=this.options.version||this.major||3,this.minor=0,!this.validate())return!1;var e=this.parse(),t=[73,68,51,this.major,this.minor,32],r=new l(new ArrayBuffer(4)),n=new Uint8Array(this.options.padding),i=this.getAudio(),a=[];for(var o in e){var s=ot[o],u={id:o,value:e[o]};s.write(u,this.major).forEach((function(e){return a.push(e)}))}r.setUint32(0,g(a.length+n.length));var f=p(t,r.getUint8(0,4),a,n,i);return this.buffer=f.buffer,this.read(),this.buffer}},{key:"parse",value:function(){var e={};return this.frames.forEach((function(t){e[t.id]?Array.isArray(e[t.id])?e[t.id].push(t.value):e[t.id]=[e[t.id],t.value]:e[t.id]=t.value})),e}},{key:"getAudio",value:function(){for(var e=new Uint8Array(this.buffer),t=0;t<e.length;){if(255===e[t]&&251===e[t+1])return new Uint8Array(this.buffer.slice(t));t++}return new Uint8Array(0)}}]),t}();function ut(e){var t=new l(e.buffer);if(0===t.getUint8(0))return!1;var r={};switch(r.id=t.getUint8String(0,4),this.major){case 3:r.size=t.getUint32(4);break;case 4:r.size=d(t.getUint32(4));break;default:throw new y(201,this.major)}r.flags=function(e,t){var r={};switch(t){case 3:r.tagAlterPreservation=v(e[0],7),r.fileAlterPreservation=v(e[0],6),r.readOnly=v(e[0],5),r.compression=v(e[1],7),r.encryption=v(e[1],6),r.groupingIdentity=v(e[1],5);break;case 4:r.tagAlterPreservation=v(e[0],6),r.fileAlterPreservation=v(e[0],5),r.readOnly=v(e[0],4),r.groupingIdentity=v(e[1],6),r.compression=v(e[1],3),r.encryption=v(e[1],2),r.unsynchronisation=v(e[1],1),r.dataLengthIndicator=v(e[1],0);break;default:throw new y(201,t)}return r}(t.getUint8(8,2),this.major);var n=ot[r.id],i=10,a=r.size,o=r.size,s=[];if(!n)return console.warn("Skipping unsupported frame: ".concat(r.id)),r;if(r.flags.dataLengthIndicator&&(a=d(t.getUint32(i)),i+=4,o-=4),3===this.major&&this.flags.unsynchronisation||4===this.major&&(this.flags.unsynchronisation||r.flags.unsynchronisation)){var u=function(e){for(var t=[],r=0;r<e.length;)t.push(e[r]),255===e[r]&&0===e[r+1]&&r++,r++;return t}(t.getUint8(i,o));s=new ArrayBuffer(a),new Uint8Array(s).set(u)}else s=t.buffer.slice(i,i+a);return r.value=n.parse(new l(s),this.major),r}return function(){function t(r,n){if(e(this,t),r instanceof ArrayBuffer==!1)throw new TypeError("buffer is not an instance of ArrayBuffer");this.buffer=r,this.options=n||{},this.tagger={}}return r(t,[{key:"frames",get:function(){return this.tagger.frames},set:function(e){this.tagger.frames=e}}]),r(t,[{key:"read",value:function(){if("ID3"===new l(this.buffer).getUint8String(0,3))this.tagger=new st(this.buffer,this.options),this.tagger.read();else{if(this.tagger=new st(this.buffer,this.options),!(this.tagger.getAudio().length>0))throw new y(1);this.save()}}},{key:"save",value:function(){this.buffer=this.tagger.save()}},{key:"getBlob",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio/mpeg";return new Blob([this.buffer],{type:e})}}]),t}()}));
