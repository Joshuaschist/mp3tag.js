!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).MP3Tag=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function u(t,e,r){return(u=s()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&o(i,r.prototype),i}).apply(null,arguments)}function f(t){var e="function"==typeof Map?new Map:void 0;return(f=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return u(t,arguments,a(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,t)})(t)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return function(){var e,r=a(t);if(s()){var n=a(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return c(this,e)}}function l(t,e){return(t&1<<e)>0}function g(t){for(var e=0,r=2130706432;r;)e>>=1,e|=t&r,r>>=8;return e}function d(t){for(var e=0,r=127;2147483647^r;)e=t&~r,e<<=1,e|=t&r,r=(r+1<<8)-1,t=e;return e}function v(){for(var t=[],e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.forEach((function(e){e.forEach?e.forEach((function(e){return t.push(e)})):t.push(e)})),new Uint8Array(t)}var w={0:"Unknown error",1:"This format is not yet supported",200:"This file is not an ID3v2",201:"Unsupported ID3v2 major version",202:"Unsupported frame",203:"Frame validation failed",204:"Frame is not supported in this version of ID3v2"},p=function(t){i(a,t);var r=h(a);function a(t){var n;return e(this,a),(n=r.call(this,w[t])).name="TagError",n.code=t,n.errorId=arguments.length<=1?void 0:arguments[1],n.message=n.parseMessage(),n}return n(a,[{key:"parseMessage",value:function(){var t="";switch(this.code){case 200:t="ID3v2 Error: ".concat(w[this.code]);break;case 201:case 202:case 203:case 204:t="ID3v2 Error: ".concat(w[this.code],' "').concat(this.errorId,'"');break;default:t="".concat(w[this.code])}return t}}]),a}(f(Error));function y(t,e){var r={};switch(e){case 3:r.unsynchronisation=l(t,7),r.extendedHeader=l(t,6),r.experimentalIndicator=l(t,5);break;case 4:r.unsynchronisation=l(t,7),r.extendedHeader=l(t,6),r.experimentalIndicator=l(t,5),r.footerPresent=l(t,4);break;default:throw new p(201,e)}return r}var m=["ascii","utf-16","utf-16be","utf-8"];function b(t,e){var r,n=m[t.getUint8(0)];switch(e){case 3:r=t.getCString(1,n).string.split("/");break;case 4:r=t.getString(1,t.byteLength-1,n).string.split("\0");break;default:throw new p(201,e)}return 1===r.length?r[0]:r}function A(t,e){var r=b(t,e),n=function(t){return null!==t.match(/^(\d+)$/)?parseInt(t):t};return r=Array.isArray(r)?r.map((function(t){return n(t)})):n(r)}function T(t,e){var r=b(t,e),n=[];Array.isArray(r)||(r=[r]);for(var i=0;i<r.length;i+=2){var a={};r[i]&&(a.position=parseInt(r[i])),r[i+1]&&(a.total=parseInt(r[i+1])),n.push(a)}return 1===n.length?n[0]:n}function E(t,e){return t.getCString(0,"ascii").string}function S(t,e){var r=m[t.getUint8(0)],n=t.getCString(4,r),i=n.length+4,a=t.byteLength-i,o=t.getString(i,a,r);return{language:t.getString(1,3,"ascii").string,descriptor:n.string,text:o.string}}function U(t,e){for(var r=!1,n=0;n<t.length&&!r;){if(k(t[n],e)){r=!0;break}n++}return r}function k(e,r){for(var n in e){if(t(e[n])!==t(r[n]))return!1;switch(t(e[n])){case"object":if(!k(e[n],r[n]))return!1;break;case"function":if(void 0===r[n]||e[n].toString()!==r[n].toString())return!1;break;default:if(e[n]!==r[n])return!1}}for(var i in r)if(void 0===e[i])return!1;return!0}var I=/^(https?):\/\/[^\s/$.?#]+\.[^\s]*/,O=/^([a-z]{3}|XXX)$/,C=/^(.+)$/,j="(0[1-9]|1\\d|2\\d|3[0-1])",L="(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",D=new RegExp("^(".concat("(\\d{4})","(-").concat("(0[1-9]|1[0-2])","(-").concat(j,"(T").concat("(0\\d|1\\d|2[0-3])","(:").concat(L,"(:").concat("(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",")?)?)?)?)?)$"));function x(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("string"!=typeof t)throw new p(203,"Value is not a string");if(!t.match(C))throw new p(203,"Newlines are not allowed")})),!0}function P(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("number"!=typeof t)throw new p(203,"Value is not a number")})),!0}function R(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("number"!=typeof t.position)throw new p(203,"Position is not a number");if(t.total&&"number"!=typeof t.total)throw new p(203,"Total is not a number");if(t.total&&t.position>t.total)throw new p(203,"Position is greater than total")})),!0}function B(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){switch(e){case 3:if(!t.toString().match(/^(\d{4})$/))throw new p(203,"Value is not 4 numeric characters");break;case 4:if("string"!=typeof t)throw new p(203,"Value is not a string");if(!t.match(D))throw new p(203,"Time frames should follow ISO 8601")}})),!0}function M(t,e){if(t.length>1)throw new p(203,"Multiple `W???` frames are not allowed");return t.forEach((function(t){if("string"!=typeof t)throw new p(203,"URL is not a string");if(!t.match(I))throw new p(203,"URL is not a valid URL")})),!0}function F(e,r){var n=[];return e.forEach((function(e){if("object"!==t(e))throw new p(203,"Value is not an object");if(e.language=e.language||"eng","string"!=typeof e.language||"string"!=typeof e.descriptor||"string"!=typeof e.text)throw new p(203,"Language/descriptor/text is not a string");if(!e.language.match(O))throw new p(203,"Language does not follow ISO 639-2");if(!e.descriptor.match(C))throw new p(203,"Newlines are not allowed");var r={language:e.language,descriptor:e.descriptor};if(U(n,r))throw new p(203,"Language and descriptor should not duplicate");n.push(r)})),!0}function V(t,e){var r=[];switch(e){case"utf-8":r=function(t){for(var e=[],r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||n>=57344?e.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&t.charCodeAt(r)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return e}(t);break;case"utf-16":case"utf-16be":for(var n=new ArrayBuffer(2*t.length),i=new Uint16Array(n),a=new Uint8Array(n),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);r=[255,254],a.forEach((function(t){return r.push(t)}));break;default:for(var s=0;s<t.length;s++)r.push(t.charCodeAt(s))}return r}var N=function(t){i(a,t);var r=h(a);function a(){e(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return"number"==typeof n[0]&&(n[0]=new Uint8Array(n[0])),Array.isArray(n[0])&&(n[0]=new Uint8Array(n[0])),ArrayBuffer.isView(n[0])&&(n[0]=n[0].buffer),r.call.apply(r,[this].concat(n))}return n(a,[{key:"getString",value:function(t,e,r){var n=this.getUint8(t,e);Array.isArray(n)||(n=[n]);var i="";switch(r){case"utf-8":i=function(t){var e="",r=0,n=0,i=0,a=0;for(r+=239===t[0]&&187===t[1]&&191===t[2]?3:0;r<t.length;)switch((n=t[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:i=t[r++],e+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=t[r++],a=t[r++],e+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&a)<<0);break;default:e+=""}return e}(n);break;case"utf-16":case"utf-16be":var a=null;255===n[0]&&254===n[1]?a=!0:254===n[0]&&255===n[1]&&(a=!1),null!==a&&(t+=2,e-=2),i=this.getUint16String(t,e,!0===a);break;default:i=this.getUint8String(t,e)}return{string:"\0"===i[i.length-1]?i.substr(0,i.length-1):i,length:n.length}}},{key:"getCString",value:function(t,e){var r,n,i=this.byteLength-t;switch(e){case"utf-16":case"utf-16be":n=2,r=this.getUint16(t,i);break;default:n=1,r=this.getUint8(t,i)}Array.isArray(r)||(r=[r]);for(var a=0;a<r.length;a++)if(0===r[a]){i=(a+1)*n;break}return this.getString(t,i,e)}},{key:"getUint8String",value:function(t,e){var r=this.getUint8(t,e),n="";Array.isArray(r)||(r=[r]);for(var i=0;i<r.length;i++){n+=String.fromCharCode(r[i])}return n}},{key:"getUint16String",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.getUint16(t,e,r),i="";Array.isArray(n)||(n=[n]);for(var a=0;a<n.length;a++){var o=String.fromCharCode(n[a]);i+=o}return i}},{key:"getUint8",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=t+e,n=[];if(this.byteLength-r<0)return!1;for(var i=t;i<r;i++){var a=DataView.prototype.getUint8.call(this,i);n.push(a)}return 1===n.length?n[0]:n}},{key:"getUint16",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e%2!=0&&(e-=1);var n=t+e,i=[];if(this.byteLength-n<0)return!1;for(var a=t;a<n;a+=2){var o=DataView.prototype.getUint16.call(this,a,r);i.push(o)}return 1===i.length?i[0]:i}}]),a}(f(DataView));function W(t,e,r){var n=V(t,"ascii"),i=new N(4);switch(r){case 3:i.setUint32(0,e);break;case 4:i.setUint32(0,d(e))}return v(n,i.getUint8(0,4),0,0)}function _(t,e,r){var n=0,i=[];switch(t=Array.isArray(t[0])?t[0]:[t[0]],r){case 3:n=1,i=V(t.join("/")+"\0","utf-16");break;case 4:n=3,i=V(t.join("\0")+"\0","utf-8")}return v(W(e,i.length+1,r),n,i)}function z(t,e,r){var n=[];switch(t=Array.isArray(t[0])?t[0]:[t[0]],r){case 3:n=V(t.join("/")+"\0","ascii");break;case 4:n=V(t.join("\0")+"\0","ascii")}return v(W(e,n.length+1,r),0,n)}function $(t,e,r){var n=[];return t.forEach((function(t){var e=t.position.toString();t.total&&(e+="/"+t.total.toString()),n.push(e)})),z(n,e,r)}function Y(t,e,r){var n=V(t[0]+"\0","ascii");return v(W(e,n.length,r),n)}function X(t,e,r){var n=[];return t.forEach((function(t){var i,a,o=0,s=V(t.language,"ascii");switch(r){case 3:o=1,i=V(t.descriptor+"\0","utf-16"),a=V(t.text+"\0","utf-16");break;case 4:o=3,i=V(t.descriptor+"\0","utf-8"),a=V(t.text+"\0","utf-8")}var u=i.length+a.length+4;v(W(e,u,r),o,s,i,a).forEach((function(t){return n.push(t)}))})),n}function G(t){return function(t){if(!t.match(/^([A-Z0-9]{4})$/))throw new p(203,"ID is invalid");return!0}(t)}var K={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getCString(1,"ascii"),i=t.getUint8(n.length+1),a=t.getCString(n.length+2,r),o=n.length+a.length+2,s=t.byteLength-o,u=t.getUint8(o,s);return{format:n.string,type:i,description:a.string,data:u}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.format||"string"!=typeof t.description||"number"!=typeof t.type)throw new p(203,"Format/type/description is invalid");if(!(t.data instanceof ArrayBuffer||Array.isArray(t.data)||ArrayBuffer.isView(t.data)))throw new p(203,"Image data should be ArrayBuffer or an array");if(!t.format.match(/(image\/[a-z0-9!#$&.+\-^_]+){0,129}/))throw new p(203,"Format should be an image");if(t.description.length>64)throw new p(203,"Description should not exceed 64");if(r.includes(t.description))throw new p(203,"Cover description should not duplicate");r.push(t.description)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i=0,a=V(t.format+"\0","ascii"),o=new Uint8Array(t.data),s=[];switch(r){case 3:i=1,s=V(t.description+"\0","utf-16");break;case 4:i=3,s=V(t.description+"\0","utf-8")}var u=a.length+s.length+o.length+2;v(W(e,u,r),i,a,t.type,s,o).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},Z={parse:S,validate:F,write:X,version:[3,4]},H={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getCString(1,"ascii"),i=t.getCString(n.length+1,r),a=t.getCString(i.length+n.length+1,r),o=n.length+i.length+a.length+1,s=t.byteLength-o,u=t.getUint8(o,s);return{format:n.string,filename:i.string,description:a.string,object:u}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.format||"string"!=typeof t.filename||"string"!=typeof t.description)throw new p(203,"Format/filename/description is not a string");if(!(t.object instanceof ArrayBuffer||Array.isArray(t.object)||ArrayBuffer.isView(t.object)))throw new p(203,"Object data should be ArrayBuffer or an array");if(r.includes(t.description))throw new p(203,"GEOB description should not duplicate");r.push(t.description)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i,a,o,s=V(t.format+"\0","ascii"),u=new Uint8Array(t.object);switch(r){case 3:i=1,a=V(t.filename+"\0","utf-16"),o=V(t.description+"\0","utf-16");break;case 4:i=3,a=V(t.filename+"\0","utf-8"),o=V(t.description+"\0","utf-8")}var f=s.length+a.length+o.length+u.length+1;v(W(e,f,r),i,s,a,o,u).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},q={parse:function(t,e){for(var r=m[t.getUint8(0)],n=[],i=1;i<t.byteLength;){var a=t.getCString(i,r);n.push(a.string),i+=a.length}return n},validate:x,write:function(t,e,r){var n=[];return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){V(t+"\0","utf-16").forEach((function(t){return n.push(t)}))})),v(W(e,n.length+1,r),1,n)},version:[3]},J={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getString(1,3,"ascii"),i=t.getCString(4,"ascii"),a=t.getString(i.length+4,8,"ascii"),o=i.length+a.length+4,s=t.byteLength-o,u=t.getString(o,s,r);return{currency:{code:n.string,price:i.string},date:a.string,seller:u.string}},validate:function(e,r){if(e.length>1)throw new p("Multiple `OWNE` frames are not allowed");return e.forEach((function(e){if("object"!==t(e))throw new p(203,"Value is not an object");if("object"!==t(e.currency)||"string"!=typeof e.date||"string"!=typeof e.seller)throw new p(203,"Value is not valid");if("string"!=typeof e.currency.code||"string"!=typeof e.currency.price)throw new p(203,"Currency values are not valid");if(!e.currency.code.match(/^([A-Z]{3})$/))throw new p(203,"Currency code is not valid");if(!e.currency.price.match(/^(\d*)\.(\d+)$/))throw new p(203,"Currency price is not valid");if(!e.date.match("".concat("(\\d{4})").concat("(0[1-9]|1[0-2])").concat(j)))throw new p(203,"Date must follow this format: YYYYMMDD")})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i,a=0,o=V(t.currency.code,"ascii"),s=V(t.currency.price+"\0","ascii"),u=V(t.date,"ascii");switch(r){case 3:a=1,i=V(t.seller,"utf-16");break;case 4:a=3,i=V(t.seller,"utf-8")}var f=s.length+i.length+12;v(W(e,f,r),a,o,s,u,i).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},Q={parse:function(t,e){var r=t.getCString(0,"ascii"),n=t.getUint8(r.length,t.byteLength-r.length);return{ownerId:r.string,data:n}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.ownerId)throw new p(203,"ownerId is not a string");if(!t.ownerId.match(I))throw new p(203,"ownerId is an invalid URL");if(!(t.data instanceof ArrayBuffer||Array.isArray(t.data)||ArrayBuffer.isView(t.data)))throw new p(203,"Data should be an ArrayBuffer or array");if(U(r,t.data))throw new p(203,"Data should not duplicate");r.push(t.data)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i=V(t.ownerId,"ascii"),a=new Uint8Array(t.data),o=i.length+a.length;v(W(e,o,r),i,a).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},tt={parse:function(t,e){return t.getUint32(0)}},et={parse:function(t,e){return{group:t.getUint8(0),signature:t.getUint8(1,t.byteLength-1)}},validate:function(t,e){var r=[];return t.forEach((function(t){if("number"!=typeof t.group)throw new p(203,"Group ID is not a number");if(t.group<0||t.group>255)throw new p(203,"Group ID should be in the range of 0 - 255");if(!(t.signature instanceof ArrayBuffer||Array.isArray(t.signature)||ArrayBuffer.isView(t.signature)))throw new p(203,"Signature should be an ArrayBuffer or array");if(U(r,t))throw new p(203,"SIGN contents should be identical to others");r.push(t)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i=new Uint8Array(t.signature),a=i.length+1;v(W(e,a,r),t.group,i).forEach((function(t){return n.push(t)}))})),n},version:[4]},rt={parse:b,validate:x,write:_,version:[3,4]},nt={parse:A,validate:P,write:z,version:[3,4]},it={parse:b,validate:x,write:_,version:[3,4]},at={parse:b,validate:x,write:_,version:[3,4]},ot={parse:b,validate:x,write:_,version:[3,4]},st={parse:b,validate:B,write:z,version:[3]},ut={parse:b,validate:B,write:z,version:[4]},ft={parse:A,validate:P,write:z,version:[3]},ct={parse:b,validate:B,write:z,version:[4]},ht={parse:b,validate:B,write:z,version:[4]},lt={parse:b,validate:B,write:z,version:[4]},gt={parse:b,validate:B,write:z,version:[4]},dt={parse:b,validate:x,write:_,version:[3,4]},vt={parse:b,validate:x,write:_,version:[3,4]},wt={parse:b,validate:x,write:_,version:[3,4]},pt={parse:b,validate:B,write:z,version:[3]},yt={parse:b,validate:x,write:_,version:[4]},mt={parse:b,validate:x,write:_,version:[3,4]},bt={parse:b,validate:x,write:_,version:[3,4]},At={parse:b,validate:x,write:_,version:[3,4]},Tt={parse:b,validate:function(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("string"!=typeof t)throw new p(203,"Value is not a string");if(!t.match(/^([A-Gb#mo]{3})$/))throw new p(203,"Invalid TKEY Format (e.g. Cbm)")})),!0},write:z,version:[3,4]},Et={parse:b,validate:function(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("string"!=typeof t)throw new p(203,"Value is not a string");if(!t.match(O))throw new p(203,"Language does not follow ISO 639-2")})),!0},write:z,version:[3,4]},St={parse:A,validate:P,write:z,version:[3,4]},Ut={parse:b,validate:x,write:_,version:[4]},kt={parse:b,validate:x,write:_,version:[3,4]},It={parse:b,validate:x,write:_,version:[4]},Ot={parse:b,validate:x,write:_,version:[3,4]},Ct={parse:b,validate:x,write:_,version:[3,4]},jt={parse:b,validate:x,write:_,version:[3,4]},Lt={parse:b,validate:x,write:_,version:[3,4]},Dt={parse:b,validate:B,write:z,version:[3]},xt={parse:b,validate:x,write:_,version:[3,4]},Pt={parse:b,validate:x,write:_,version:[3,4]},Rt={parse:b,validate:x,write:_,version:[3,4]},Bt={parse:b,validate:x,write:_,version:[3,4]},Mt={parse:b,validate:x,write:_,version:[3,4]},Ft={parse:T,validate:R,write:$,version:[3,4]},Vt={parse:b,validate:x,write:_,version:[4]},Nt={parse:b,validate:x,write:_,version:[3,4]},Wt={parse:T,validate:R,write:$,version:[3,4]},_t={parse:b,validate:x,write:_,version:[3]},zt={parse:b,validate:x,write:_,version:[3,4]},$t={parse:b,validate:x,write:_,version:[3,4]},Yt={parse:A,validate:P,write:z,version:[3]},Xt={parse:b,validate:x,write:_,version:[4]},Gt={parse:b,validate:x,write:_,version:[4]},Kt={parse:b,validate:x,write:_,version:[4]},Zt={parse:b,validate:x,write:_,version:[4]},Ht={parse:b,validate:function(t,e){if(t.length>1)throw new p(203,"Multiple `T???` frames are not allowed");return(t=Array.isArray(t[0])?t[0]:[t[0]]).forEach((function(t){if("string"!=typeof t)throw new p(203,"Value is not a string");if(!t.match(/^([A-Z0-9]{12})$/))throw new p(203,"Invalid ISRC format")})),!0},write:z,version:[3,4]},qt={parse:b,validate:x,write:_,version:[3,4]},Jt={parse:b,validate:x,write:_,version:[4]},Qt={parse:b,validate:B,write:z,version:[3]},te={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getCString(1,r),i=n.length+1,a=t.byteLength-i,o=t.getString(i,a,r);return{description:n.string,text:o.string}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.description||"string"!=typeof t.text)throw new p(203,"Text/description is not a string");if(!t.description.match(C)||!t.text.match(C))throw new p("Newlines are not allowed");if(r.includes(t.description))throw new p(203,"Description should not duplicate");r.push(t.description)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(i){var a,o,s=0;switch(r){case 3:s=1,a=V(i.description+"\0","utf-16"),o=V(i.text+"\0","utf-16");break;case 4:s=3,a=V(t.description+"\0","utf-8"),o=V(t.text+"\0","utf-8")}var u=a.length+o.length+1;v(W(e,u,r),s,a,o).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},ee={parse:function(t,e){var r=t.getCString(0,"ascii"),n=t.getUint8(r.length,t.byteLength-r.length);return{ownerId:r.string,id:n}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.ownerId)throw new p(203,"ownerId is not a string");if(""===t.ownerId)throw new p(203,"ownerId should not be blank");if(!(t.id instanceof ArrayBuffer||Array.isArray(t.id)||ArrayBuffer.isView(t.id)))throw new p(203,"id should be ArrayBuffer or an array");if((t.id.byteLength||t.id.length||0)>64)throw new p(203,"id should not exceed 64 bytes");if(r.includes(t.ownerId))throw new p(203,"ownerId should not duplicate");r.push(t.ownerId)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i=V(t.ownerId+"\0","ascii"),a=new Uint8Array(t.id);v(W(e,i.length+a.length,r),i,a).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},re={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getString(4,t.byteLength-4,r);return{language:t.getString(1,3,"ascii").string,text:n.string}},validate:function(e,r){return e.forEach((function(e){if("object"!==t(e))throw new p(203,"Value is not an object");if(e.language=e.language||"eng","string"!=typeof e.language||"string"!=typeof e.text)throw new p(203,"Language/text is not a string");if(!e.language.match(O))throw new p(203,"Language does not follow ISO 639-2")})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i,a=0,o=V(t.language,"ascii");switch(r){case 3:a=1,i=V(t.text+"\0","utf-16");break;case 4:a=3,i=V(t.text+"\0","utf-8")}v(W(e,i.length+4,r),a,o,i).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},ne={parse:S,validate:F,write:X,version:[3,4]},ie={parse:E,validate:M,write:Y,version:[3,4]},ae={parse:E,validate:M,write:Y,version:[3,4]},oe={parse:E,validate:M,write:Y,version:[3,4]},se={parse:E,validate:M,write:Y,version:[3,4]},ue={parse:E,validate:M,write:Y,version:[3,4]},fe={parse:E,validate:M,write:Y,version:[3,4]},ce={parse:E,validate:M,write:Y,version:[3,4]},he={parse:E,validate:M,write:Y,version:[3,4]},le={parse:function(t,e){var r=m[t.getUint8(0)],n=t.getCString(1,r),i=n.length+1,a=t.byteLength-i,o=t.getString(i,a,"ascii");return{description:n.string,url:o.string}},validate:function(t,e){var r=[];return t.forEach((function(t){if("string"!=typeof t.description||"string"!=typeof t.url)throw new p(203,"Text/URL is not a string");if(!t.description.match(C))throw new p(203,"Newlines are not allowed");if(!t.url.match(I))throw new p(203,"URL is an invalid URL");if(r.includes(t.description))throw new p(203,"Description should not duplicate");r.push(t.description)})),!0},write:function(t,e,r){var n=[];return t.forEach((function(t){var i,a,o=0;switch(r){case 3:o=1,i=V(t.description+"\0","utf-16"),a=V(t.url+"\0","ascii");break;case 4:o=3,i=V(t.description+"\0","utf-8"),a=V(t.url+"\0","ascii")}var s=i.length+a.length+1;v(W(e,s,r),o,i,a).forEach((function(t){return n.push(t)}))})),n},version:[3,4]},ge=Object.freeze({__proto__:null,validateID:G,APIC:K,COMM:Z,GEOB:H,IPLS:q,OWNE:J,PRIV:Q,SEEK:tt,SIGN:et,TALB:rt,TBPM:nt,TCOM:it,TCON:at,TCOP:ot,TDAT:st,TDEN:ut,TDLY:ft,TDOR:ct,TDRC:ht,TDRL:lt,TDTG:gt,TENC:dt,TEXT:vt,TFLT:wt,TIME:pt,TIPL:yt,TIT1:mt,TIT2:bt,TIT3:At,TKEY:Tt,TLAN:Et,TLEN:St,TMCL:Ut,TMED:kt,TMOO:It,TOAL:Ot,TOFN:Ct,TOLY:jt,TOPE:Lt,TORY:Dt,TOWN:xt,TPE1:Pt,TPE2:Rt,TPE3:Bt,TPE4:Mt,TPOS:Ft,TPRO:Vt,TPUB:Nt,TRCK:Wt,TRDA:_t,TRSN:zt,TRSO:$t,TSIZ:Yt,TSOA:Xt,TSOC:Gt,TSOP:Kt,TSOT:Zt,TSRC:Ht,TSSE:qt,TSST:Jt,TYER:Qt,TXXX:te,UFID:ee,USER:re,USLT:ne,WCOM:ie,WCOP:ae,WOAF:oe,WOAR:se,WOAS:ue,WORS:fe,WPAY:ce,WPUB:he,WXXX:le}),de=function(){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.buffer=r,this.options={padding:void 0!==n.padding?n.padding:4096,version:void 0!==n.version&&n.version},this.frames=[]}return n(t,null,[{key:"isID3v2",value:function(t){return"ID3"===new N(t).getString(0,3,"ascii").string}}]),n(t,[{key:"read",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=new N(this.buffer,t);if("ID3"!==e.getUint8String(0,3))throw new p(200);var r=e.getUint8(3,2);switch(r[0]){case 3:case 4:this.major=r[0],this.minor=r[1];break;default:throw new p(201,r[0])}this.size=g(e.getUint32(6)),this.flags=y(e.getUint8(5),this.major),this.frames=[];for(var n=10,i=this.size;n<this.size;){var a=e.getUint8(n,i),o=ve.call(this,a);if(!o)break;n+=o.size+10,i-=o.size+10,"SEEK"===o.id?this.read(n+o.value):this.frames.push(o)}return this.frames}},{key:"validate",value:function(){if(3!==this.major&&4!==this.major)throw new p(201,this.major);var t=this.getFrames();for(var e in t){var r=ge[e];if(!r)throw new p(202,e);if(!r.version.includes(this.major))throw new p(204,e);G(e);try{r.validate(t[e],this.major)}catch(t){throw new p(203,"ID: ".concat(e,", Message: ").concat(t.message))}}return!0}},{key:"save",value:function(){if(0===this.frames.length)return this.getAudio().buffer;if(this.major=this.options.version||this.major||3,this.minor=0,!this.validate())return!1;var t=this.getFrames(),e=[73,68,51,this.major,this.minor,0],r=new N(4),n=new Uint8Array(this.options.padding),i=this.getAudio(),a=[];for(var o in t){ge[o].write(t[o],o,this.major).forEach((function(t){return a.push(t)}))}return r.setUint32(0,d(a.length+n.length)),this.buffer=v(e,r.getUint8(0,4),a,n,i).buffer,this.read(),this.buffer}},{key:"getFrames",value:function(){var t={};return this.frames.forEach((function(e){void 0!==t[e.id]?t[e.id].push(e.value):t[e.id]=[e.value]})),t}},{key:"addFrame",value:function(t,e){this.frames.push({id:t,value:e})}},{key:"editFrame",value:function(t,e,r,n){var i=this.frames,a=0;this.frames.forEach((function(o,s){o.id===t&&(a===r&&(Array.isArray(i[s])?i[s].push(e):n&&(i[s]={id:t,value:e})),a++)})),this.frames=i}},{key:"existsFrame",value:function(t){var e=!1;return this.frames.forEach((function(r){r.id===t&&(e=!0)})),e}},{key:"getAudio",value:function(){for(var t=new Uint8Array(this.buffer),e=0;e<t.length;){if(255===t[e]&&251===t[e+1])return new Uint8Array(this.buffer.slice(e));e++}return new Uint8Array(0)}}]),t}();function ve(t){var e=new N(t);if(0===e.getUint8(0))return!1;var r={};switch(r.id=e.getUint8String(0,4),this.major){case 3:r.size=e.getUint32(4);break;case 4:r.size=g(e.getUint32(4));break;default:throw new p(201,this.major)}r.flags=function(t,e){var r={};switch(e){case 3:r.tagAlterPreservation=l(t[0],7),r.fileAlterPreservation=l(t[0],6),r.readOnly=l(t[0],5),r.compression=l(t[1],7),r.encryption=l(t[1],6),r.groupingIdentity=l(t[1],5);break;case 4:r.tagAlterPreservation=l(t[0],6),r.fileAlterPreservation=l(t[0],5),r.readOnly=l(t[0],4),r.groupingIdentity=l(t[1],6),r.compression=l(t[1],3),r.encryption=l(t[1],2),r.unsynchronisation=l(t[1],1),r.dataLengthIndicator=l(t[1],0);break;default:throw new p(201,e)}return r}(e.getUint8(8,2),this.major);var n=ge[r.id],i=10,a=r.size,o=r.size,s=[];if(!n)return console.warn("Skipping unsupported frame: ".concat(r.id)),r;if(r.flags.dataLengthIndicator&&(a=g(e.getUint32(i)),i+=4,o-=4),3===this.major&&this.flags.unsynchronisation||4===this.major&&(this.flags.unsynchronisation||r.flags.unsynchronisation)){var u=function(t){for(var e=[],r=0;r<t.length;)e.push(t[r]),255===t[r]&&0===t[r+1]&&r++,r++;return e}(e.getUint8(i,o));s=new Uint8Array(u)}else s=e.getUint8(i,a);return r.value=n.parse(new N(s),this.major),r}return function(){function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e(this,t),!(r instanceof ArrayBuffer||"undefined"!=typeof Buffer&&r instanceof Buffer))throw new TypeError("buffer is not an instance of ArrayBuffer or Buffer");this.name="MP3Tag",this.version="1.0.0",this.buffer=r,this.options=n,this.tagger={}}return n(t,[{key:"frames",get:function(){return this.tagger.frames},set:function(t){this.tagger.frames=t}}]),n(t,[{key:"read",value:function(){if(de.isID3v2(this.buffer))this.tagger=new de(this.buffer,this.options),this.tagger.read();else{if(this.tagger=new de(this.buffer,this.options),!(this.tagger.getAudio().length>0))throw new p(1);this.save()}}},{key:"save",value:function(){var t=this.buffer;return this.buffer=this.tagger.save(),t}},{key:"getFrames",value:function(){return this.tagger.getFrames()}},{key:"addFrame",value:function(t,e){return this.tagger.addFrame(t,e)}},{key:"editFrame",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.tagger.editFrame(t,e,r,n)}},{key:"existsFrame",value:function(t){return this.tagger.existsFrame(t)}},{key:"getBlob",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio/mpeg";return new Blob([this.buffer],{type:t})}}]),t}()}));
